

TRI-5 判定シート案と、ATR などから係数を決めるガイドライン

===

承知いたしました。
TRI-5 判定シート案と、ATR などから係数を決めるガイドライン、そのうえで使える **入力 CSV のサンプル** をお出しします。

---

## 1. TRI-5 判定シート（印刷用イメージ）

「1トレードごとに A4 1枚に書く」想定です。
ご提示いただいた式に合わせます。

> TRI-5 = 利益額 ÷（かけた時間 × 心理ストレス係数 × 難易度係数 × リスク係数）

```markdown
# TRI-5 取引評価シート

■ 日付: ___________    ■ 銘柄: ___________    ■ 市場: [ ] 日本株  [ ] 米国株

## 1. 取引概要
- エントリー理由（3行以内）:
  ________________________________________
  ________________________________________

- 利確 / 損切りの基準:
  ________________________________________

- 実現損益（円）: _________ 円
- かけた時間（分析＋場中合計）: _________ 分

---

## 2. 客観指標メモ（任意）
- ATR(14) / 終値 (%): _________ %
- 想定損失幅（ストップまで）: _________ 円
- 最大逆行幅（MAE）: _________ 円

---

## 3. 主観評価（1〜5段階）

### 3-1. 心理ストレス（S）
- 1: ほぼ無感情で見ていられた
- 2: 少しドキドキしたが許容範囲
- 3: 途中でかなり不安を感じた
- 4: ストップ近辺で「冷や汗」レベル
- 5: 正直、もう二度と同じ展開は嫌

選択: S = [ 1 / 2 / 3 / 4 / 5 ]

→ 係数（後で記入）: S_coef = _________

### 3-2. 難易度（D）
- 1: ほぼ自動的にできるパターン
- 2: EMA/VWAPだけで判断できた
- 3: 板・時間軸・インジを総合判断
- 4: 逆張り要素やニュース読みが必要
- 5: ほぼ「賭け」に近い難しさ

選択: D = [ 1 / 2 / 3 / 4 / 5 ]

→ 係数: D_coef = _________

### 3-3. リスク（R）
- 1: 低ボラ銘柄・落ち着いた値動き
- 2: そこそこ動くが想定内
- 3: 寄り後の乱高下・ギャップあり
- 4: 決算前後・イベント直後
- 5: 仮想通貨級・ストップ連発ゾーン

選択: R = [ 1 / 2 / 3 / 4 / 5 ]

→ 係数: R_coef = _________

---

## 4. 係数マッピング（目安）

心理ストレス / 難易度 / リスク共通:

- 評点1 → 係数 1.0
- 評点2 → 係数 1.1〜1.2
- 評点3 → 係数 1.3
- 評点4 → 係数 1.4
- 評点5 → 係数 1.5〜1.8

今回の係数:
- S_coef = _________
- D_coef = _________
- R_coef = _________

---

## 5. TRI-5 計算

- 利益額（円）: P = _________
- 時間（分）: T = _________
- TRI-5 = P ÷ ( T × S_coef × D_coef × R_coef )

⇒ TRI-5 = ___________________ 円/分
```

※ 今回の LITE のように
「時間 60分 / ストレス1.2 / 難易度1.4 / リスク1.4 / 利益10,900円」
なら、シートの最下段で計算して 77円/分 前後が出るイメージです。

---

## 2. 係数を「半自動化」するガイド（ATR など）

完全自動は難しいですが、「係数を決める時の物差し」として
**ATR と実際の値動き** を基準にしておくとブレが減ります。

### 2-1. リスク係数 R_coef（ATRベース）

ATR% = ATR(14) / 終値 × 100

の目安で、リスク係数をざっくり決めてしまう案です。

| ATR% | リスク感       | R_coef 目安 |
| ---- | ---------- | --------- |
| 〜1%  | かなり低ボラ     | 1.1       |
| 1〜2% | 通常の大型株     | 1.2       |
| 2〜4% | 中型株・AI関連など | 1.3       |
| 4〜6% | かなり動く、急落注意 | 1.4       |
| 6%以上 | 超高ボラ、要覚悟   | 1.5〜1.8   |

LITE の今回のように
「寄り直後にかなり動き、全体地合いと逆行する場面」なら
ATR% が高めと想定して **1.4** は妥当、という整理です。

---

### 2-2. 心理ストレス係数 S_coef（MAEベース）

MAE = そのトレード中の「最大含み損幅」

ストップまでの距離を Stop_dist とすると、

* MAE_ratio = MAE / Stop_dist

で、どれだけ「ストップに近づいたか」を定量化できます。

| MAE_ratio | 心理感覚         | S_coef 目安 |
| --------- | ------------ | --------- |
| 0〜0.3     | ほぼ安心して見ていられた | 1.1       |
| 0.3〜0.6   | 少しヒヤッとした     | 1.2       |
| 0.6〜0.9   | かなりハラハラした    | 1.3       |
| 0.9〜1.0   | ほぼ狩られかけた     | 1.4〜1.5   |

今回の LITE は
「ストップまでギリギリ行っていない / テクニカル的に想定内の押し」であれば、
MAE_ratio は 0.3〜0.5 程度 → S_coef = 1.2 前後、という読み方になります。

---

### 2-3. 難易度係数 D_coef（要素数ベース）

使った要素の数で、ある程度機械的に決めても構いません。

* 価格＋EMA10/20 だけ → 2要素 → 難易度低め
* EMA＋VWAP＋板＋ニュース → 4〜5要素 → 難易度中〜高

目安：

| 使用した判断材料               | D_coef |
| ---------------------- | ------ |
| 価格＋EMAのみ               | 1.1    |
| 価格＋EMA＋VWAP            | 1.2    |
| 価格＋EMA＋VWAP＋板 or 時間軸2つ | 1.3    |
| 上記にニュース / セクター判断も込み    | 1.4    |
| 逆張り・イベント勝負・ほぼ勘も混ざる     | 1.5〜   |

LITE の今回：

* 価格
* EMA10/20
* VWAP
* 板の様子
* 寄り直後の地合い

→ 4〜5要素なので D_coef = 1.4 は十分妥当、と整理できます。

---

## 3. 入力 CSV のサンプル

最後に、ご要望の **入力 CSV（candidates_raw.csv）のサンプル** です。
先ほどの `eval_tri5.py` でそのまま通る形になっています。

```csv
ticker,market,prep_time_min,period_months,loss_amount,win_prob,rr_ratio,win_amount,vol_std
JT,jp,45,6,30000,0.40,2.5,,15000
8058.T,jp,40,6,25000,,2.0,,18000
LITE,us,60,1,30000,0.35,2.0,,60000
MSFT,us,50,2,40000,,2.0,,50000
```

### 各列の意味（簡単に再掲）

* ticker: 銘柄コード（例: JT, 8058.T, LITE, MSFT）
* market: `jp` or `us` など（`--jp-adjust` の対象判定に使用）
* prep_time_min: その銘柄にかける分析時間（分）
* period_months: 想定保有期間（月）
* loss_amount: 損切りまでの想定損失額（円）

任意（あれば優先）:

* win_prob: 銘柄固有の勝率（なければ default + jp_adjust）
* rr_ratio: その銘柄だけ R/R を変えたい時（なければグローバルの `--rr-ratio`）
* win_amount: 期待利益を明示したい時（なければ loss_amount × rr_ratio）
* vol_std: 損益の標準偏差など（あれば TRI5 の安定性補正に使用）

---

### 使い方イメージ

```bash
python eval_tri5.py \
  --input candidates_raw.csv \
  --default-win-prob 0.35 \
  --jp-adjust 0.05 \
  --rr-ratio 2.0 \
  -z LITE_20251126
```

* `res_qg_selection/res_eg_selc_YYYYMMDD_HHMMSS_LITE_20251126/`
  以下に `result_YYYYMMDD_HHMMSS.csv` と `config.json` が出る想定です。

---

もしよろしければ次のステップとして、

* 実際の LITE・JT・8058 の数値（今回の取引ベース）を
  サンプル CSV に近い形で埋めた「現実的サンプル」を一緒に作る
* その結果 CSV を見ながら「どこまで TRI-5 を銘柄選別のフィルターに使うか」

といったところまで踏み込んで整理することも可能でございます。

次は
「実際の数値を入れたサンプル」
から進める形でよろしいでしょうか。

